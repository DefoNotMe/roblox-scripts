-- Enabled
Enabled = false
Reset = false
AutoUpgrade = {false,false}
FarmMode = "Normal"
ResetTimer = 5
LastReset = tick()

-- Non-Synapse Users
if not pcall(function() return syn.protect_gui end) then
    syn = {}
    syn.protect_gui = function(egg)
        egg.Parent = game.CoreGui
    end
end

-- Variables
local vim = game:GetService("VirtualInputManager")
local player = game.Players.LocalPlayer

-- GUI Stuff
local play = player.PlayerGui.Game.PlayFrame
local main = play.Main
local data = player.DataFolder.Value
local stuff = main.Field.Objects

-- Prestige
local prestigeGui = play.GoldenCircles
local mayo = prestigeGui.Confirm.Prestige
local cap = prestigeGui.Confirm.Captcha.Main.Captcha
local capRemote = game.ReplicatedStorage.Events.Captcha

-- Merge Quest
local tier = data.Upgrades1["1"]
local questTier = data.MergeQuest.Tier

-- Get Match
function match(img)
    local shit = stuff:GetChildren()
    for i = 1, #shit do local v = shit[i]
        if v.Visible and v:FindFirstChild("Image") and v.Image.Image == img.Image.Image and v ~= img then
            return v
        end
    end
    return false
end

-- Click Function
function click(a,b)
    vim:SendMouseButtonEvent(a.AbsolutePosition.X+a.AbsoluteSize.X/2,a.AbsolutePosition.Y+50,0,b,game,1)
end

-- Click Falling Objects
local falling = player.PlayerGui.Game.FallingObjects
falling.ChildAdded:Connect(function(v)
    wait(3)
    if Enabled then
        Enabled = false
        wait(.1)
        click(v,true)
        click(v,false)
        wait()
        Enabled = true
    end
end)

-- UI Library
local library = loadstring(game:HttpGetAsync('https://pastebin.com/raw/edJT9EGX'))()
local window = library:CreateWindow("salad bowl")
window:AddLabel({text="discord.gg/uWAMYAgSTT"})
window:AddList({text='Mode',values={"Normal","Merge-Quest"},callback=function(a)FarmMode=a;end})
window:AddBind({text='Auto-Merge Toggle',callback=function()
    Enabled = not Enabled
    LastReset = tick()
end})
local autoUp = window:AddFolder("Auto Upgrade")
autoUp:AddToggle({text='Better Circles',callback=function(a)AutoUpgrade[1]=a;end})
autoUp:AddToggle({text='Faster Circles',callback=function(a)AutoUpgrade[2]=a;end})
local presFolder = window:AddFolder("Auto Prestige")
presFolder:AddToggle({text='Enabled',callback=function(a)Reset=a;end})
presFolder:AddLabel({text="Timer to prestige"})
presFolder:AddSlider({text='Seconds',min=5,max=300,float=5,callback=function(a)ResetTimer=a;end})
library:Init()

-- Prestige Check
function prestigeCheck(FORCED)
    if FORCED or Enabled and Reset and tick()-LastReset >= ResetTimer then
        if data.NumberValues.ResetsUntilCaptcha.Value == 0 then
            local captcha = cap.PlaceholderText:split('"')[2]
            for i = 1, #captcha do local v = captcha:sub(1,i)
                capRemote:FireServer(v)
                wait(.1)
            end
            wait(1)
        end
        prestigeGui.Visible = true
        prestigeGui.Confirm.Visible = true
        mayo.Visible = true
        wait(.1)
        click(mayo,true)
        click(mayo,false)
        LastReset = tick()
    end
end

-- Skeet
while true do
    -- Check if Enabled
    if Enabled then
        -- Auto Upgrade
        for i = 1, 2 do local mayo = main.CU[i].Buy
            if Enabled and AutoUpgrade[i] == true and mayo.Price.TextColor3 ~= Color3.new(1,0,0) then
                repeat
                    click(mayo.Buy,true)
                    click(mayo.Buy,false)
                    wait()
                until not AutoUpgrade[i] or not Enabled or mayo.Price.TextColor3 == Color3.new(1,0,0)
                break
            end
        end
        -- Normal Farm
        if FarmMode == "Normal" then
            -- Auto Prestige
            prestigeCheck()
        else -- Merge-Quest
            -- Check Tier
            if tier.Value > questTier.Value then
                prestigeCheck(true)
            elseif tier.Value < questTier.Value then
                -- Get To Correct Tier
                local mayo = main.CU["1"].Buy
                repeat
                    -- Set Buy Amount
                    local amount = questTier.Value-tier.Value > 200 and 100 or questTier.Value-tier.Value > 20 and 10 or 1
                    if amount ~= player.BuyAmount.Value then
                        play.BuyAmount.Visible = true
                        play.Main.Visible = false
                        wait(.2)
                        click(play.BuyAmount.Set[amount],true)
                        click(play.BuyAmount.Set[amount],false)
                        wait(.2)
                        play.BuyAmount.Visible = false
                        play.Main.Visible = true
                    end
                    -- Click
                    click(mayo.Buy,true)
                    click(mayo.Buy,false)
                    wait(questTier.Value-tier.Value <= 10 and 0.35 or 0.1)
                until not Enabled or mayo.Price.TextColor3 == Color3.new(1,0,0) or questTier.Value == tier.Value
            end
        end
        -- Auto Merge
        local femboy = stuff:GetChildren()
        table.sort(femboy, function(a,b)
            return data.Tiers[a.Name].Value > data.Tiers[b.Name].Value 
        end)
        for i = 1, #femboy do local v = femboy[i]
            if Enabled and v.Visible and v:FindFirstChild("Image") and v.Image.Image ~= "rbxassetid://5134453133" then
                local sex = match(v)
                if sex then
                    vim:SendMouseMoveEvent(v.AbsolutePosition.X+v.AbsoluteSize.X/2,v.AbsolutePosition.Y+v.AbsoluteSize.Y/2,game)
                    wait()
                    click(v,true)
                    wait()
                    vim:SendMouseMoveEvent(sex.AbsolutePosition.X+sex.AbsoluteSize.X/2,sex.AbsolutePosition.Y+sex.AbsoluteSize.Y/2,game)
                    wait()
                    click(sex,false)
                    wait(.1)
                    break
                end
            end
        end
    end
    wait()
end
